# /usr/bin/env python

# PROJECT:	    EO4Atlantic
# MODULE:		forest_change.py
# AUTHOR:		Treemetrics
# DESCRIPTION: 	This module manages the analysis and the outputs.

# COPYRIGHT:	(C) 2017 Treemetrics all rights reserved.
# ==========================================================================================
""" This module manages the analysis and outputs"""

import os
import shutil
import errno
import logging

import config
import args_reader
import change_script
from bunch import Config

# Check configuration
config.check_config()

# Read args
args = args_reader.main()

# Set tempdir
if 'tempdir' in args and args.tempdir:
    tempdir = args.tempdir

elif 'dataset1' in args:
    tempdir = os.path.join(os.path.dirname(args.dataset1), 'temp')

else:
    raise Exception("Temporary directory cannot not been defined. Aborting ..")

if not os.path.exists(tempdir):
    try:
        os.makedirs(tempdir)

    except OSError as e:
        if e.errno != errno.EEXIST:
            raise Exception("Error creating temporary directory:" + str(tempdir))

Config()['tempdir'] = tempdir

# Runs script
change_script.main(d1=args.dataset1, d2=args.dataset2, output=args.output, settings=args.parameters)

# Wipe temp files
if 'tempdir' in Config() and os.path.exists(Config()['tempdir']):
    shutil.rmtree(Config()['tempdir'])
